{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "shipiq-agent-full",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "cfea7087-66db-43d7-bb95-52d3193330b2",
      "name": "Webhook - Receive Repo Data",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -432,
        688
      ],
      "webhookId": "shipiq-agent-full"
    },
    {
      "parameters": {
        "jsCode": "// Extract and parse input data with enhanced metadata and error handling\nconst inputData = $input.first().json.body || $input.first().json;\n\nlet repoData;\ntry {\n  if (typeof inputData.input_value === 'string') {\n    repoData = JSON.parse(inputData.input_value);\n  } else {\n    repoData = inputData.input_value || inputData;\n  }\n} catch (e) {\n  throw new Error(`Invalid input data: ${e.message}`);\n}\n\n// Validate required fields\nif (!repoData.repository?.name || !repoData.repository?.owner) {\n  throw new Error('Repository name and owner are required');\n}\n\n// Extract key information with fallbacks\nconst language = repoData.language || 'JavaScript';\nconst repositoryName = repoData.repository.name;\nconst repoOwner = repoData.repository.owner;\nconst repoUrl = repoData.repository.url || `https://github.com/${repoOwner}/${repositoryName}`;\nconst manifestFilename = repoData.manifest_filename || 'package.json';\nconst metadata = repoData.metadata || {};\nconst gapReport = Array.isArray(repoData.gap_report) ? repoData.gap_report : [];\nconst dependencies = JSON.stringify(metadata.dependencies || {}, null, 2);\nconst scripts = JSON.stringify(metadata.scripts || {}, null, 2);\nconst description = metadata.description || `A ${language} application`;\n\n// Determine file to generate with priority order\nlet fileType = 'dockerfile';\nlet fileName = 'Dockerfile';\nlet filePath = 'Dockerfile';\n\nif (gapReport.includes('missing_dockerfile')) {\n  fileType = 'dockerfile';\n  fileName = 'Dockerfile';\n  filePath = 'Dockerfile';\n} else if (gapReport.includes('missing_ci_cd_workflow')) {\n  fileType = 'cicd';\n  fileName = 'main.yml';\n  filePath = '.github/workflows/main.yml';\n} else if (gapReport.includes('missing_README_documentation')) {\n  fileType = 'readme';\n  fileName = 'README.md';\n  filePath = 'README.md';\n}\n\n// Generate unique identifiers\nconst timestamp = Date.now();\nconst branchName = `shipiq-devops-${fileType}-${timestamp}`;\nconst commitMessage = `feat: Add ${fileName} via ShipIQ DevOps Agent`;\n\nreturn {\n  json: {\n    language,\n    repositoryName,\n    repoOwner,\n    repoUrl,\n    manifestFilename,\n    dependencies,\n    scripts,\n    description,\n    gapReport,\n    fileType,\n    fileName,\n    filePath,\n    branchName,\n    commitMessage,\n    timestamp,\n    originalData: repoData,\n    attemptNumber: 1,\n    maxAttempts: 3,\n    workflowStartTime: new Date().toISOString()\n  }\n};"
      },
      "id": "d186a6f5-5118-4d41-b83d-627b7e720ee0",
      "name": "Extract & Prepare Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -192,
        688
      ]
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "owner": "={{ $json.repoOwner }}",
        "repository": "={{ $json.repositoryName }}",
        "title": "ðŸš€ ShipIQ: Add {{ $json.fileName }} - DevOps Automation",
        "body": "=## ðŸ¤– Automated DevOps Enhancement\n\nThis PR was automatically generated by **ShipIQ DevOps Agent** to add missing DevOps infrastructure.\n\n### ðŸ“‹ What's Added:\n- **File**: `{{ $json.fileName }}`\n- **Type**: {{ $json.fileType }}\n- **Language**: {{ $json.language }}\n- **Generated by**: {{ $json.modelUsed }}\n- **Content Length**: {{ $json.contentLength }} characters\n\n### ðŸ” Preview:\n```\n{{ $json.generatedContent.substring(0, 500) }}{{ $json.generatedContent.length > 500 ? '...' : '' }}\n```\n\n### âœ… Ready for Review:\n- [ ] Review generated {{ $json.fileName }}\n- [ ] Test deployment pipeline\n- [ ] Verify functionality\n- [ ] Approve and merge\n\n---\n*Generated by ShipIQ DevOps Agent - Automated DevOps Enhancement Platform*",
        "labels": "{{ $json.fileType }},devops,automated",
        "assignees": []
      },
      "id": "a449978a-a24e-4dd2-b40d-3697b10048a3",
      "name": "GitHub - Create Issue/PR",
      "type": "n8n-nodes-base.github",
      "typeVersion": 1,
      "position": [
        2432,
        1024
      ],
      "webhookId": "f94e0976-b419-43c3-a381-d9bee960a10b",
      "credentials": {
        "githubOAuth2Api": {
          "id": "Gnd0tgyVtsRGTmbe",
          "name": "GitHub account"
        }
      }
    },
    {
      "parameters": {
        "amount": 30,
        "unit": "seconds"
      },
      "id": "19d38074-1cfe-4e40-93b8-10ee2818384b",
      "name": "Wait for GitHub Actions",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        2640,
        1024
      ],
      "webhookId": "a3bc1322-7e5b-4438-b993-8c9122237742"
    },
    {
      "parameters": {
        "url": "=https://api.github.com/repos/{{ $json.repoOwner }}/{{ $json.repositoryName }}/actions/runs",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "status",
              "value": "completed"
            },
            {
              "name": "per_page",
              "value": "5"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{ $credentials.githubApi.accessToken }}"
            },
            {
              "name": "Accept",
              "value": "application/vnd.github.v3+json"
            }
          ]
        },
        "options": {}
      },
      "id": "ceea218b-a28f-452a-87ba-1174f9ad322c",
      "name": "HTTP - Check Actions Status",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2864,
        1024
      ]
    },
    {
      "parameters": {
        "jsCode": "// Analyze GitHub Actions results and determine next steps\nconst actionsData = $input.first().json;\nconst inputData = $('Extract & Prepare Data').first().json;\n\n// Get the most recent workflow run\nconst latestRun = actionsData.workflow_runs?.[0];\n\nif (!latestRun) {\n  return {\n    json: {\n      ...inputData,\n      status: 'no_runs_found',\n      needsRetry: false,\n      error: 'No workflow runs found',\n      action: 'wait_more',\n      lastChecked: new Date().toISOString()\n    }\n  };\n}\n\nconst status = latestRun.conclusion; // success, failure, cancelled, neutral\nconst runId = latestRun.id;\nconst runUrl = latestRun.html_url;\n\n// Determine action based on status\nlet needsRetry = false;\nlet action = 'success';\nlet error = null;\n\nif (status === 'failure') {\n  needsRetry = inputData.attemptNumber < inputData.maxAttempts;\n  action = needsRetry ? 'retry' : 'max_attempts_reached';\n  error = `Workflow run ${runId} failed`;\n} else if (status === 'success') {\n  action = 'success';\n} else if (status === 'cancelled') {\n  needsRetry = inputData.attemptNumber < inputData.maxAttempts;\n  action = needsRetry ? 'retry' : 'cancelled';\n  error = `Workflow run ${runId} was cancelled`;\n} else {\n  action = 'wait_more';\n  error = `Workflow run ${runId} status: ${status}`;\n}\n\nreturn {\n  json: {\n    ...inputData,\n    status,\n    runId,\n    runUrl,\n    needsRetry,\n    action,\n    error,\n    lastChecked: new Date().toISOString()\n  }\n};"
      },
      "id": "a3685866-ae9a-4e2e-b2e2-6a2e8690856b",
      "name": "Analyze Actions Status",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2992,
        656
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "0b159643-1a15-4446-a876-53555fbca154",
      "name": "Route by Deployment Status",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        3184,
        1024
      ]
    },
    {
      "parameters": {
        "url": "=https://api.github.com/repos/{{ $json.repoOwner }}/{{ $json.repositoryName }}/actions/runs/{{ $json.runId }}/logs",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{ $credentials.githubApi.accessToken }}"
            },
            {
              "name": "Accept",
              "value": "application/vnd.github.v3+json"
            }
          ]
        },
        "options": {
          "timeout": 30000
        }
      },
      "id": "b1adb42f-73f1-4891-ad93-1368b761499a",
      "name": "HTTP - Get Workflow Logs",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3392,
        1024
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "Bearer {{ $credentials['Google Gemini (PaLM) Api account'].apiKey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "contents",
              "value": "=[{\n  \"parts\": [{\n    \"text\": \"You are a DevOps expert specializing in deployment troubleshooting and error analysis. Analyze failed deployments and provide improved versions with better error handling. Always respond with ONLY the improved file content, no explanations or markdown formatting.\\n\\nAnalyze this failed GitHub Actions deployment and provide an improved version:\\n\\n**Failed Deployment Details:**\\n- Repository: {{ $json.repositoryName }}\\n- File Type: {{ $json.fileType }}\\n- Language: {{ $json.language }}\\n- Run ID: {{ $json.runId }}\\n- Error: {{ $json.error }}\\n- Attempt Number: {{ $json.attemptNumber }}\\n- Previous Content: {{ $json.generatedContent.slice(0, 1000) }}\\n- Recent Logs: {{ $json.data && $json.data[0] ? $json.data[0].name : 'no_logs_available' }}\\n\\n**Common Issues to Address:**\\n1. Docker build failures (base image, dependencies, permissions)\\n2. Missing environment variables or secrets\\n3. Port conflicts or network issues\\n4. Test failures or linting errors\\n5. Resource constraints (memory, CPU)\\n6. Permission issues or authentication problems\\n7. Path or file structure problems\\n8. Version compatibility issues\\n\\n**Requirements:**\\n1. Analyze the likely cause of failure based on file type and error\\n2. Generate an improved version with:\\n   - Better error handling\\n   - Retry logic for network operations\\n   - Proper resource management\\n   - Enhanced logging and debugging\\n   - Fallback mechanisms\\n   - Health checks\\n3. Include troubleshooting comments\\n4. Optimize for the specific failure scenario\\n\\nGenerate ONLY the improved {{ $json.fileName }} content:\"\n  }]\n}]"
            },
            {
              "name": "generationConfig",
              "value": "={\n  \"temperature\": 0.1,\n  \"maxOutputTokens\": 3500\n}"
            }
          ]
        },
        "options": {
          "timeout": 180000
        }
      },
      "id": "72473101-57ce-4ac4-97ab-64fb562eb5b4",
      "name": "AI - Fix Deployment Issues",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3584,
        1024
      ]
    },
    {
      "parameters": {
        "jsCode": "// Prepare retry attempt with improved content\nconst aiFixResponse = $input.first().json;\nconst originalData = $('Extract & Prepare Data').first().json;\n\n// Extract improved content from Gemini response\nlet improvedContent = '';\nif (aiFixResponse.candidates && aiFixResponse.candidates[0] && aiFixResponse.candidates[0].content && aiFixResponse.candidates[0].content.parts) {\n  improvedContent = aiFixResponse.candidates[0].content.parts[0].text;\n} else if (aiFixResponse.error) {\n  throw new Error(`Gemini API error: ${aiFixResponse.error.message}`);\n} else {\n  throw new Error('Unexpected Gemini response format for retry');\n}\n\n// Clean up the content\nif (improvedContent.includes('```')) {\n  const lines = improvedContent.split('\\n');\n  const startIndex = lines.findIndex(line => line.trim().startsWith('```'));\n  const endIndex = lines.findIndex((line, index) => index > startIndex && line.trim().endsWith('```'));\n  if (startIndex !== -1 && endIndex !== -1) {\n    improvedContent = lines.slice(startIndex + 1, endIndex).join('\\n');\n  }\n}\n\nconst newAttemptNumber = originalData.attemptNumber + 1;\nconst newBranchName = `shipiq-devops-${originalData.fileType}-${originalData.timestamp}-retry-${newAttemptNumber}`;\nconst newCommitMessage = `fix: Improve ${originalData.fileName} - Attempt ${newAttemptNumber} (ShipIQ)`;\n\nreturn {\n  json: {\n    ...originalData,\n    generatedContent: improvedContent.trim(),\n    attemptNumber: newAttemptNumber,\n    branchName: newBranchName,\n    commitMessage: newCommitMessage,\n    isRetry: true,\n    previousAttempt: originalData.attemptNumber,\n    improvementReason: 'AI-generated improvements based on failure analysis',\n    readyForCommit: true,\n    retryTime: new Date().toISOString()\n  }\n};"
      },
      "id": "7014e333-a03d-466b-a445-aafd16fa8e86",
      "name": "Prepare Retry Attempt",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3760,
        1024
      ]
    },
    {
      "parameters": {
        "amount": "={{ Math.min(300, 30 * Math.pow(2, $json.attemptNumber - 1)) }}",
        "unit": "seconds"
      },
      "id": "ea2728ab-fab6-4230-86ff-89544de893c2",
      "name": "Wait Before Retry (Backoff)",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        3984,
        1024
      ],
      "webhookId": "cbf5c416-c167-4bbb-8d05-3ca26f76cd0a"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"success\": true,\n  \"action\": \"{{ $json.action }}\",\n  \"status\": \"{{ $json.status }}\",\n  \"repository\": {\n    \"owner\": \"{{ $json.repoOwner }}\",\n    \"name\": \"{{ $json.repositoryName }}\",\n    \"url\": \"{{ $json.repoUrl }}\"\n  },\n  \"file\": {\n    \"type\": \"{{ $json.fileType }}\",\n    \"name\": \"{{ $json.fileName }}\",\n    \"path\": \"{{ $json.filePath }}\",\n    \"size\": {{ $json.contentLength }}\n  },\n  \"deployment\": {\n    \"status\": \"{{ $json.status }}\",\n    \"runId\": \"{{ $json.runId }}\",\n    \"runUrl\": \"{{ $json.runUrl }}\",\n    \"attempt\": {{ $json.attemptNumber }},\n    \"maxAttempts\": {{ $json.maxAttempts }}\n  },\n  \"timestamp\": \"{{ $json.lastChecked }}\",\n  \"message\": \"Deployment {{ $json.status === 'success' ? 'completed successfully' : $json.status === 'failure' ? 'failed - check run for details' : 'in progress' }}\"\n}",
        "options": {}
      },
      "id": "fa99bd8b-4293-4d1e-a410-c62e806843fc",
      "name": "Respond - Success",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        3328,
        768
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"success\": false,\n  \"action\": \"{{ $json.action }}\",\n  \"status\": \"{{ $json.status }}\",\n  \"repository\": {\n    \"owner\": \"{{ $json.repoOwner }}\",\n    \"name\": \"{{ $json.repositoryName }}\",\n    \"url\": \"{{ $json.repoUrl }}\"\n  },\n  \"error\": {\n    \"message\": \"{{ $json.error }}\",\n    \"runId\": \"{{ $json.runId }}\",\n    \"runUrl\": \"{{ $json.runUrl }}\",\n    \"attempts\": {{ $json.attemptNumber }},\n    \"maxAttempts\": {{ $json.maxAttempts }}\n  },\n  \"timestamp\": \"{{ $json.lastChecked }}\",\n  \"message\": \"Deployment failed after {{ $json.attemptNumber }} attempts. Manual intervention required.\"\n}",
        "options": {}
      },
      "id": "1ab1ccb4-c75c-4a7e-a8b1-a38bf2d02c05",
      "name": "Respond - Max Attempts Reached",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        3312,
        592
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a DevOps expert. Generate a complete and production-ready Dockerfile for a JavaScript application based on the following data:\n\n{{ JSON.stringify($json) }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        512,
        208
      ],
      "id": "57698e27-0616-419e-a54e-a2f149669e88",
      "name": "Dockerfile Generation",
      "credentials": {
        "googlePalmApi": {
          "id": "uYgttZqku9vOWIil",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a DevOps expert specializing in CI/CD pipelines. Generate robust GitHub Actions workflows with comprehensive error handling and retry logic. Always respond with ONLY the YAML content, no explanations or markdown formatting.\n\nGenerate a GitHub Actions workflow for this {{ $json.language }} application.\n\nRepository: {{ $json.repositoryName }}\nPackage File: {{ $json.manifestFilename }}\nScripts Available: {{ $json.scripts }}\nAttempt: {{ $json.attemptNumber }}\n\nRequirements:\n1. Trigger on push to main and pull requests\n2. Use appriate {{ $json.language }} version (Node 18+ for JS/TS)\n3. Install dependencies using {{ $json.manifestFilename }} with retry logic\n4. Run tests if test script exists with proper error handling\n5. Run build if build script exists\n6. Add comprehensive security scanning\n7. Cache dependencies for faster builds with fallback\n8. Run on ubuntu-latest with matrix strategy if needed\n9. Include deployment status reporting\n10. Add retry mechanisms for flaky operations\n11. Include proper artifact management\n12. Add rollback capabilities\n\nGenerate ONLY the .github/workflows/main.yml content:"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        496,
        432
      ],
      "id": "27290deb-115e-4352-93a1-cb9412a98132",
      "name": "Configuring CI/CD pipelines",
      "credentials": {
        "googlePalmApi": {
          "id": "uYgttZqku9vOWIil",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a technical writer and DevOps expert specializing in creating clear and comprehensive documentation for software projects. Always respond with ONLY the Markdown content for the README.md file, with no explanations.\n\nGenerate a professional README.md file for the following application.\n\nProject Name: {{ $json.repositoryName }}\nDescription: {{ $json.description }}\nLanguage: {{ $json.language }}\nRun Command: {{ $json.scripts }}\n\nRequirements:\n1.  Include a main heading with the Project Name.\n2.  Add placeholder badges for build status and license.\n3.  Use the provided Description for an overview section.\n4.  Create a \"Features\" section with a few logical bullet points for this type of application.\n5.  Provide clear \"Installation\" and \"Usage\" sections. The Usage section should detail how to run the project using the provided run command.\n6.  List the primary technologies used.\n\nGenerate ONLY the content for the README.md file."
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        480,
        656
      ],
      "id": "c3d8e575-13ef-41b5-be8d-ffc0e7dc59cc",
      "name": "Documentation Generator",
      "credentials": {
        "googlePalmApi": {
          "id": "uYgttZqku9vOWIil",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "d7c9541b-6515-4c92-86db-e6115e777ebc",
              "leftValue": "={{ $json.gapReport }}",
              "rightValue": "={{ $json.gapReport[0] }}",
              "operator": {
                "type": "array",
                "operation": "contains",
                "rightType": "any"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        256,
        224
      ],
      "id": "68413b74-148d-4a8a-8968-eba6d0c3333d",
      "name": "If Dockerfile Missing"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "d8d43089-02c0-4fae-88df-1d2794dac728",
              "leftValue": "={{ $json.gapReport }}",
              "rightValue": "={{ $json.gapReport[1] }}",
              "operator": {
                "type": "array",
                "operation": "contains",
                "rightType": "any"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        272,
        448
      ],
      "id": "565d745c-c826-4c1c-96ea-c5ff001c4350",
      "name": "If CI/CD pipelines absent"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3cfd33af-4dc8-4aa8-a031-0bb27c5c841e",
              "leftValue": "={{ $json.gapReport }}",
              "rightValue": "={{ $json.gapReport[2] }}",
              "operator": {
                "type": "array",
                "operation": "contains",
                "rightType": "any"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        240,
        672
      ],
      "id": "a498cca0-4b92-4875-89f2-ac57b4d0b2b8",
      "name": "If documentation absent"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1296,
        336
      ],
      "id": "ae7603dc-b979-49fd-bdd0-f07c6294072b",
      "name": "Merge"
    },
    {
      "parameters": {
        "jsCode": "// // Process combined files coming directly from the Merge node (no aggregator needed)\n\n// const baseData = $('Extract & Prepare Data').first().json;\n// const allFiles = $input.all().map(item => item.json); // Each input item is one file\n// const finalCommits = [];\n\n// for (const generatedFile of allFiles) {\n//   let fileContent = generatedFile.fileContent || '';\n  \n//   // Clean code blocks if the LLM wrapped output in ```\n//   if (fileContent.includes('```')) {\n//     const lines = fileContent.split('\\n');\n//     if (\n//       lines[0].trim().startsWith('```') &&\n//       lines[lines.length - 1].trim().startsWith('```')\n//     ) {\n//       fileContent = lines.slice(1, -1).join('\\n');\n//     }\n//   }\n\n//   // Build the commit data object\n//   finalCommits.push({\n//     json: {\n//       repositoryName: baseData.originalData.repository.name,\n//       repoOwner: baseData.originalData.repository.owner,\n//       fileName: generatedFile.fileName,\n//       fileContent: fileContent.trim(),\n//       readyForCommit: true,\n//     },\n//   });\n// }\n\n// // Return one item per file ready to commit\n// return finalCommits;\n\n\n\n// Process AI Response\n// Runs once after Aggregate Generated Files outputs allFiles[]\n// Prepares files for GitHub commit\n\nconst baseData = $('Extract & Prepare Data').first().json;\nconst allFiles = $json.allFiles || [];\nconst finalCommits = [];\n\nfor (const generatedFile of allFiles) {\n  let fileContent = generatedFile.fileContent || '';\n\n  // Clean code fences (```...```)\n  if (fileContent.includes('```')) {\n    const lines = fileContent.split('\\n');\n    if (\n      lines[0].trim().startsWith('```') &&\n      lines[lines.length - 1].trim().startsWith('```')\n    ) {\n      fileContent = lines.slice(1, -1).join('\\n');\n    }\n  }\n\n  // Create a commit-ready object for each file\n  finalCommits.push({\n    json: {\n      repositoryName: baseData.originalData.repository.name,\n      repoOwner: baseData.originalData.repository.owner,\n      fileName: generatedFile.fileName,\n      fileContent: fileContent.trim(),\n      readyForCommit: true\n    }\n  });\n}\n\n// Return one item per file ready to commit\nreturn finalCommits;\n"
      },
      "id": "f80033c2-2a81-4786-817b-6e2467bac318",
      "name": "Process AI Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1824,
        592
      ]
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        64,
        384
      ],
      "id": "bb4d29a7-56ce-49b0-a11c-20084124b021",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {
        "url": "=https://api.github.com/repos/{{ $json.originalData.repository.owner }}/{{ $json.originalData.repository.name }}/git/refs/heads/main",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/vnd.github.v3+json"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        224,
        0
      ],
      "id": "27f548f8-47cd-49a7-b7e0-4f703fd15db5",
      "name": "Get Main Branch SHA",
      "credentials": {
        "httpHeaderAuth": {
          "id": "G5AJQ4pi2s7FOrfJ",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.github.com/repos/{{ $('Extract & Prepare Data').first().json.originalData.repository.owner }}/{{ $('Extract & Prepare Data').first().json.originalData.repository.name }}/git/refs",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "JSON"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"ref\": \"refs/heads/{{ $('Set Branch Name').first().json.branchName }}\",\n  \"sha\": \"{{ $('Get Main Branch SHA').first().json.object.sha }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        448,
        0
      ],
      "id": "29b0efa8-d60b-4788-82c3-4846f56e5473",
      "name": "Create the New Branch",
      "credentials": {
        "httpHeaderAuth": {
          "id": "G5AJQ4pi2s7FOrfJ",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "resource": "file",
        "owner": {
          "__rl": true,
          "value": "={{ $json.repoOwner }}\n",
          "mode": ""
        },
        "repository": {
          "__rl": true,
          "value": "={{ $json.repositoryName }}\n",
          "mode": ""
        },
        "filePath": "={{ $json.fileName }}",
        "fileContent": "={{ $json.fileContent }}",
        "commitMessage": "=feat: Add/update {{ $json.fileName }}",
        "additionalParameters": {
          "branch": {
            "branch": "={{ $('Set Branch Name').first().json.branchName }}"
          }
        }
      },
      "id": "9d16390e-1e1c-4e2c-a7ba-094b521baf2e",
      "name": "GitHub - Commit",
      "type": "n8n-nodes-base.github",
      "typeVersion": 1,
      "position": [
        2048,
        752
      ],
      "webhookId": "920bae36-fe47-42ac-88a8-d36472db6959",
      "credentials": {
        "githubOAuth2Api": {
          "id": "Gnd0tgyVtsRGTmbe",
          "name": "GitHub account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "82c7a51e-0bef-4715-8df9-b05640942457",
              "name": "fileName",
              "value": "README.md",
              "type": "string"
            },
            {
              "id": "554d28f7-2a78-4593-8f50-24eb9f9e4476",
              "name": "fileContent",
              "value": "={{ $json.content.parts[0].text }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        928,
        656
      ],
      "id": "36a38ef4-33b7-4693-9dee-ea708f6f2a35",
      "name": "Set Node Documentation"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3a3b07d1-18fd-4e9a-85ed-c4f2116d810e",
              "name": "fileName",
              "value": "Dockerfile",
              "type": "string"
            },
            {
              "id": "0e699a91-cc12-4f33-a51c-017bd8ff0d65",
              "name": "fileContent",
              "value": "={{ $json.content.parts[0].text }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        976,
        208
      ],
      "id": "eab21ef0-c0bd-4a1f-95af-4d13da3c37bb",
      "name": "Set Node Dockerfile"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "edf58c8f-376a-48b9-95ac-f001445f7a31",
              "name": "fileName",
              "value": ".github/workflows/main.yml",
              "type": "string"
            },
            {
              "id": "56f7f80c-5f7c-43ac-b3df-5b311861d8fb",
              "name": "fileContent",
              "value": "={{ $json.content.parts[0].text }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        944,
        432
      ],
      "id": "2e9a081e-8879-4e23-93b9-22281f5fa5bb",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8c1a0811-02ca-4465-b890-4df17e77bfb0",
              "name": "branchName",
              "value": "=shipiq-agent-{{ $now.ts }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        0,
        0
      ],
      "id": "b30faca6-52b5-43b3-911c-8be99cb59a4e",
      "name": "Set Branch Name"
    },
    {
      "parameters": {
        "jsCode": "// // // This node acts as a synchronization barrier across branches\n// // // Works in n8n v1.113.3 where `this.getWorkflowStaticData()` is unavailable\n\n// // const allInputs = $input.all().map(i => i.json);\n\n// // // Use the global object to simulate temporary in-memory storage\n// // globalThis.__aggregatedFiles__ = globalThis.__aggregatedFiles__ || [];\n\n// // // Add the current branch's file(s)\n// // globalThis.__aggregatedFiles__.push(...allInputs);\n\n// // // Adjust this number to match how many branches you expect\n// // const EXPECTED_FILE_COUNT = 3;\n\n// // // Once all branches have added their outputs, release combined data\n// // if (globalThis.__aggregatedFiles__.length >= EXPECTED_FILE_COUNT) {\n// //   const allFiles = globalThis.__aggregatedFiles__;\n// //   delete globalThis.__aggregatedFiles__; // clear memory\n// //   return [{ json: { allFiles } }];\n// // } else {\n// //   // Hold until other branches finish â€” output nothing yet\n// //   return [];\n// // }\n// // Aggregate Generated Files Node\n// // Works in n8n v1.113.3 - synchronizes parallel branches\n\n// // const allInputs = $input.all().map(i => i.json);\n// // const allFiles = $input.all().map(i => i.json);\n\n// // // Persistent memory across branches during this workflow run\n// // globalThis.__aggregatedFiles__ = globalThis.__aggregatedFiles__ || [];\n\n// // // Add this branch's data\n// // globalThis.__aggregatedFiles__.push(...allInputs);\n\n// // // Number of branches expected (adjust if needed)\n// // const EXPECTED_FILE_COUNT = 3;\n\n// // // Check if all branches have finished\n// // if (globalThis.__aggregatedFiles__.length >= EXPECTED_FILE_COUNT) {\n// //   const allFiles = globalThis.__aggregatedFiles__;\n// //   delete globalThis.__aggregatedFiles__; // clear memory\n\n// //   // Output once with all files combined\n// //   return [{ json: { allFiles, complete: true } }];\n// // } else {\n// //   // Return a passive flag so the workflow doesn't break\n// //   return [{ json: { complete: false }, {\n// //     allFiles,\n// //     complete: true\n// //   } }];\n// // }\n\n\n// // Aggregate Generated Files Node\n// // Combine all items coming from Merge (Append) node into one object\n\n// const allFiles = $input.all().map(i => i.json);\n\n// // Output one combined object with all files\n// return [{\n//   json: {\n//     allFiles,\n//     complete: true\n//   }\n// }];\n\n\n\n// Aggregate Generated Files Node\n// Collects results from multiple branches and waits until all have arrived\n// Works in n8n v1.113.3 (self-hosted) with sandboxed Code node\n\nconst allInputs = $input.all().map(i => i.json);\n\n// Use globalThis to persist partial results between parallel branch executions\nglobalThis.__aggregatedFiles__ = globalThis.__aggregatedFiles__ || [];\n\n// Push the new files from this branch execution\nglobalThis.__aggregatedFiles__.push(...allInputs);\n\n// Define how many files you expect (adjust if needed)\nconst EXPECTED_FILE_COUNT = 3;\n\n// When all expected files have arrived:\nif (globalThis.__aggregatedFiles__.length >= EXPECTED_FILE_COUNT) {\n  const allFiles = globalThis.__aggregatedFiles__;\n  delete globalThis.__aggregatedFiles__; // clear memory for next run\n  \n  // Output a single combined payload for the next node\n  return [{\n    json: {\n      allFiles,\n      complete: true\n    }\n  }];\n} else {\n  // Early branches return \"complete: false\" so workflow continues safely\n  return [{\n    json: {\n      complete: false\n    }\n  }];\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1216,
        832
      ],
      "id": "08da1437-44db-4563-9c57-361c99c4e7a1",
      "name": "Aggregate Generated Files",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f88b1bd1-93e0-4de1-9e62-58f95888159a",
              "leftValue": "={{ $json.complete }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1584,
        608
      ],
      "id": "878e59c9-0903-4528-9bac-a897151e074c",
      "name": "If"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a685e850-a04a-4c83-8da0-c5e6f4883e90",
              "name": "complete",
              "value": true,
              "type": "boolean"
            },
            {
              "id": "017b991b-4b74-4e35-a5e0-7be744b5e320",
              "name": "allFiles",
              "value": "={{ $input.all().map(item => item.json) }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1280,
        608
      ],
      "id": "b02b8b85-925c-4de2-973f-cbce0c945a7c",
      "name": "Combine Files for Commit"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook - Receive Repo Data": {
      "main": [
        [
          {
            "node": "Extract & Prepare Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract & Prepare Data": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Set Branch Name",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GitHub - Create Issue/PR": {
      "main": [
        [
          {
            "node": "Wait for GitHub Actions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait for GitHub Actions": {
      "main": [
        [
          {
            "node": "HTTP - Check Actions Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP - Check Actions Status": {
      "main": [
        [
          {
            "node": "Analyze Actions Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Actions Status": {
      "main": [
        [
          {
            "node": "Route by Deployment Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by Deployment Status": {
      "main": [
        [
          {
            "node": "Respond - Success",
            "type": "main",
            "index": 0
          },
          {
            "node": "HTTP - Get Workflow Logs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP - Get Workflow Logs": {
      "main": [
        [
          {
            "node": "AI - Fix Deployment Issues",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI - Fix Deployment Issues": {
      "main": [
        [
          {
            "node": "Prepare Retry Attempt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Retry Attempt": {
      "main": [
        [
          {
            "node": "Wait Before Retry (Backoff)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dockerfile Generation": {
      "main": [
        [
          {
            "node": "Set Node Dockerfile",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Configuring CI/CD pipelines": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Documentation Generator": {
      "main": [
        [
          {
            "node": "Set Node Documentation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Dockerfile Missing": {
      "main": [
        [
          {
            "node": "Dockerfile Generation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If CI/CD pipelines absent": {
      "main": [
        [
          {
            "node": "Configuring CI/CD pipelines",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If documentation absent": {
      "main": [
        [
          {
            "node": "Documentation Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Combine Files for Commit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process AI Response": {
      "main": [
        [
          {
            "node": "GitHub - Commit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing1": {
      "main": [
        [
          {
            "node": "If CI/CD pipelines absent",
            "type": "main",
            "index": 0
          },
          {
            "node": "If Dockerfile Missing",
            "type": "main",
            "index": 0
          },
          {
            "node": "If documentation absent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Main Branch SHA": {
      "main": [
        [
          {
            "node": "Create the New Branch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Node Documentation": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Node Dockerfile": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Branch Name": {
      "main": [
        [
          {
            "node": "Get Main Branch SHA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Generated Files": {
      "main": [
        []
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Process AI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Combine Files for Commit": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "076bf5f8-12e6-4b86-a3b9-2021a5e886f5",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "e21ed69fe6f64f07ab5702952ae7cef9d26ea2f69ee8f8c6d2f535b2350d5c32"
  },
  "id": "nh6JFoyhoqsiAEyj",
  "tags": []
}